This should be a CUDA extension with cub